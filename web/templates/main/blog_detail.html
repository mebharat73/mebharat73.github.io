{% extends 'main/base.html' %}
{% load static %}
{% block title %}
    Blog Detail
{% endblock %}
{% block main_content %}

<!-- Post Content -->
<article>
    <header class="intro-header">
        <div class="container">
            <div class="row clearfix">
                <div class="col-md-8 content col-sm-12">
                    <div class="main-image">
                        {% if images %}
                            <img id="main-image" src="{{ images.0.image.url }}">
                        {% endif %}
                    </div>

                    <h2 class="section-heading">{{ blog.title }}</h2>
                    <p class="blog-content">{{ blog.content|striptags }}</p>

                    <div class="post-meta">
                        Posted by <a href="#">{{ blog.author }}</a> on {{ blog.created_at }}
                    </div>

                    <!-- Like button -->
                    <div class="like-container">
                        <button class="like-btn" data-obj-type="post" data-obj-id="{{ blog.id }}">
                            <span class="like-text">Like</span>
                            <span class="like-count">({{ blog.likes_count }})</span>
                        </button>
                    </div>
                </div>

                <div class="col-md-4 sidebar col-sm-12">
                    <div class="side-images" id="sidebar-images">
                        {% for image in images|slice:":4" %}
                            <div class="related-image" style="display: block;">
                                <img src="{{ image.image.url }}" class="img-fluid">
                            </div>
                        {% empty %}
                            <p>No images available for this post.</p>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <section class="comment-section">
                <!-- Comment icon -->
                <button class="comment-toggle-btn" id="comment-toggle-btn">
                    <span>Comment</span>
                </button>

                <!-- Comment form (hidden by default) -->
                <div class="comment-form-container" style="display: none;">
                    <form action="{% url 'add_comment' %}" method="post" enctype="multipart/form-data" class="comment-form">
                        {% csrf_token %}
                        <input type="hidden" name="blog_id" value="{{ blog.id }}"/>
                        <div class="form-group">
                            <textarea name="content" class="form-control" placeholder="Write a comment...">{{ comment_form.content.value }}</textarea>
                            {% if comment_form.content.errors %}
                                <div class="error-message">
                                    {{ comment_form.content.errors.0 }}  <!-- Display the first error -->
                                </div>
                            {% endif %}
                            <span class="char-counter"></span>
                        </div>
                        <button type="submit" class="btn btn-comment">Comment</button>
                    </form>
                </div>

                <ul class="comment-list">
                    <div class="container mb-5 mt-5">
                        <div class="card">
                            <div class="row">
                                <div class="col-md-12">
                                    {% for comment in comments %}
                                    <div class="media comment-box">
                                        <img src="{% if comment.author.profile.profile_picture %}{{ comment.author.profile.profile_picture.url }}{% else %}{% static 'main/image/default-profile-picture.jpg' %}{% endif %}" alt="Profile Picture" class="profile-pic comment-pic">
                                        <div class="media-body">
                                            <div class="comment-header">
                                                <h5>{{ comment.author }}<span> -- {{ comment.created_at }}</span></h5>
                                            </div>
                                            <span class="comment-content">{{ comment.content }}</span>
                                            <a href="#" class="reply-btn" data-comment-id="{{ comment.id }}">Reply</a>
                
                                            <div class="reply-form-container" style="display: none;">
                                                <form method="post" action="{% url 'add_comment_reply' comment.id %}" data-comment-id="{{ comment.id }}">
                                                    {% csrf_token %}
                                                    <div class="form-group">
                                                        <textarea name="content" class="form-control" placeholder="Write a reply..."></textarea>
                                                        <span class="char-counter"></span>
                                                    </div>
                                                    <button type="submit" class="btn btn-reply">Reply</button>
                                                </form>
                                            </div>
                                            <div class="reply-container">
                                                {% for reply in comment.replies %}
                                                    <div class="media reply-box {% if forloop.counter > 4 %}hidden-reply{% endif %}">
                                                        <img src="{% if reply.author.profile.profile_picture %}{{ reply.author.profile.profile_picture.url }}{% else %}{% static 'main/image/default-profile-picture.jpg' %}{% endif %}" alt="Profile Picture" class="profile-pic reply-pic">
                                                        <div class="media-body">
                                                            <div class="reply-header">
                                                                <h6>{{ reply.author }}<span class="created-at"> -- {{ reply.created_at }}</span></h6>
                                                            </div>
                                                            <span class="reply-content">{{ reply.content }}</span>
                                                        </div>
                                                    </div>
                                                {% empty %}
                                                    <p>No replies yet.</p>
                                                {% endfor %}
                                                
                                                {% if comment.replies.count > 4 %}
                                                    <button class="more-replies btn btn-primary">
                                                        More: ({{ comment.replies.count|add:-4 }})
                                                    </button>
                                                {% endif %}
                                            </div>
                                            
                                        </div>
                                    </div>
                                    {% empty %}
                                        <p>No comments available.</p>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </ul>
            </section>
        </div>
    </header>
</article>


<style>

    /* Main Image Styles */
    .main-image {
        width: 925px;
        height: 490px;
        overflow: hidden;
        border-radius: 8px;
        box-shadow: 0 4px 15px rgba(0, 0, 0.2, 0.4); 
        margin-top: 60px;
        position: relative;
        aspect-ratio: 16 / 9; /* Adjust based on your image aspect ratio */
        border: 2px solid #24fc08; /* Add border with color */
    }

    .main-image img {
        width: 925px;
        height: 490px;
        object-fit: fill; /* Changed to cover for better image fitting */
        border-radius: 8px;
    }

    /* Section Heading */
    .section-heading {
        font-size: 3rem;
        margin-top: 10px;
        color: #4249f3;
    }

    /* Blog Content */
    .blog-content {
        font-size: 1.6rem;
        line-height: 1.2;
        color: #000000;
        text-align: justify;
        margin: 0 1.5rem;
        word-spacing: 0.1rem;
        padding: 0;
        margin-left: 5px;
        width: 919px;
    }

    /* Post Meta Information */
    .post-meta {
        font-size: 1.1rem;
        color: #ff07e8;
        margin-top: 10px;
        margin-left: 3px;
    }

    /* Sidebar Image Styles */
    .side-images {
        display: flex;
        flex-direction: column;
        margin-top: 60px;
    }

    .related-image {
        width: 125%;
        height: 230px;
        overflow: hidden;
        margin-bottom: 10px;
        border-radius: 12px;
        border: 2px solid #bd01fc; /* Add border with color */
        box-shadow: 0 2px 10px rgba(0, 0, 0.2, 0.4); 
    }

    .related-image img {
        width: 125%;
        height: 105%;
        object-fit: fill;
        border-radius: 4px;
    }

    /* Sidebar and Content Layout */
    .sidebar {
        width: 20%;
        float: right;
        margin-left: 5px;
    }

    /* CSS for image transition */
    #main-image, #sidebar-images img {
        transition: opacity 0.5s ease-in-out; /* Adjust duration and easing as needed */
        opacity: 1; /* Start fully visible */
    }


    .main-image:hover {
        border-color: #ff07e8; /* Change border color on hover */
    }
    
    .related-image:hover {
        border-color: #46fc01; /* Change border color on hover */
    }

    /* Like Button Container */
    .like-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 5px;
    }

    /* Like Button Styles */
    .like-btn {
        background-color: #6c52fd;
        color: white;
        border: none;
        padding: 5px 10px;
        font-size: 1.2rem;
        cursor: pointer;
        border-radius: 12px;
        transition: transform 0.2s ease;
        display: flex;
        align-items: center;
        height: 25px;
        width: 60px;
    }

    .like-btn:active {
        transform: scale(0.95);
    }

    .like-count {
        margin-left: 5px;
        font-weight: bold;
        font-size: 1rem;
    }


    /* Comment Toggle Button Styles */
    .comment-toggle-btn {
        background-color: #007bff;
        color: white;
        border: none;
        height: 23px;
        width: 78px;
        cursor: pointer;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 13px;
        font-weight: bold;
        margin-right: -50px; /* Adjusted for better alignment */
        margin-top: -5px;
        float: right;
    }

   
    /* Comment Form Styles */
    .comment-form-container {
        display: flex; /* Use flexbox for layout */
        padding: 5px; /* Add padding for spacing */
        margin-left: -30px; /* Adjust left margin as needed */
        margin-top: 5px; /* Adjust top margin as needed */
    }
    
    .comment-form {
        width: 99%; /* Set to 90% for responsiveness */
        display: flex; /* Use flexbox for inner layout */
        flex-direction: column; /* Stack elements vertically */
    }
    
    .comment-form input[type="text"],
    .comment-form textarea {
        height: 50px; /* Set height for input field */
        padding: 5px; /* Add padding */
        font-size: 14px; /* Set font size */
        border: 1px solid #ccc; /* Light border */
        border-radius: 12px; /* Rounded corners */
        width: 100%; /* Full width */
        box-sizing: border-box; /* Include padding and border in total width */
        margin-bottom: -10px; /* Space below input field */
    }
    
    .comment-form textarea {
        height: 35px; /* Adjust height for textarea */
        resize: none; /* Disable resizing */
    }
    
    .comment-form button {
        padding: 5px;
        background-color: #fa1de7; /* Button background color */
        height: 23px;
        width: 80px;
        color: white; /* Button text color */
        border: none; /* No border */
        border-radius: 10px; /* Rounded corners */
        cursor: pointer; /* Pointer cursor */
        transition: background-color 0.3s ease; /* Transition for hover effect */
    }
    
    .comment-form button:hover {
        background-color: #0056b3; /* Darker shade on hover */
    }


    .btn-comment {
        background-color: #fb28ea;
        color: white;
        padding: 1px 3px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 10px; /* Font size */
        transition: background-color 0.3s; /* Smooth transition for background color */
    }

    .btn-comment:hover {
        background-color: #fb2845; /* Darker shade on hover */
    }

   
    .comment-box {
        width: 1190px; /* Fixed width for larger screens */
        background-color: #f8f9fa; /* Light gray background */
        border: 1.0px solid #001fff; /* Border color */
        border-radius: 10px; /* Rounded corners */
        padding: 10px; /* Increased padding for better spacing */
        display: flex;
        margin-bottom: -13px; /* Space between comments */
        line-height: 1.2; /* Adjust line height for better readability */
        float: left;
        margin-left: -55px;
    
        /* Box Shadow */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Add shadow */
    }

    /* Comment Header */
    .comment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: bold; /* Make the author's name bold */
        color: #3e72fa; /* Change color to match theme */
        font-size: 1rem; /* Set font size */
        margin-top: -1px;
    }

    .media-body {
        display: flex;
        flex-direction: column; /* Stack children vertically */
        justify-content: flex-start; /* Align items at the start */
    }


    /* Comment Content */
    .comment-content {
        font-weight: bold; /* Make the author's name bold */
        font-size: 13px; /* Slightly larger font size */
        color: #69696a; /* Change color to match theme */
        line-height: 1.1;
        margin-top: -6px;
    }

    /* Reply Button */
    /* Reply form button  */
    .reply-btn {
        background-color: #7e00c6; /* Make background transparent */
        color: #08f302; /* Text color */
        text-decoration: none; /* Remove underline */
        font-size: 12px; /* Adjust font size to be smaller */
        font-weight: bold; /* Make the author's name bold */
        padding: 0; /* Remove padding to use height for centering */
        width: 55px; /* Set desired width */
        height: 22px; /* Set desired height */
        border: 1px solid #000500; /* Add a border */
        border-radius: 12px; /* Slightly rounded corners */
        cursor: pointer; /* Pointer cursor on hover */
        transition: background-color 0.3s, color 0.3s; /* Smooth transition for hover effects */
        margin-left: auto; /* Push the button to the right */
        /* Centering text */
        display: flex; /* Use flexbox */
        align-items: center; /* Center vertically */
        justify-content: center; /* Center horizontally */
    }

    .reply-btn:hover {
        background-color: #007bff; /* Change background on hover */
        color: white; /* Change text color on hover */
    }

    /* Reply container styles */


    .reply-form-container input[type="text"],
    .reply-form-container textarea {
        height: 25px; /* Set a specific height for the input field */
        padding: -15px; /* Add some padding for better text visibility */
        font-size: 13px; /* Set the font size */
        border: 1px solid #ccc; /* Light border for the input field */
        border-radius: 12px; /* Slightly rounded corners */
        width: 100%; /* Make the input field take full width */
        box-sizing: border-box; /* Include padding and border in the element's total width and height */
        margin-bottom: -10px; /* Space below the input field */
    }

    .reply-form-container textarea {
        height: 33px; /* Adjust height for textarea if needed */
        resize: none; /* Disable resizing if you want to keep it a fixed size */
    }

    .reply-form-container {
        margin-top: -10px;
        padding-left: 1px; /* Indent the reply form */
        max-width: 1060px; /* Set a maximum width for the reply form */
    }


    .reply-container {
        margin-top: 5px; /* Space above the reply container */
    }



    


    .hidden-reply {
        display: none; /* Initially hide the replies */
    }
    
    .reply-box {
        background-color: #e9ecef; /* Slightly darker gray for replies */
        margin-left: 300px;
        margin-top: 3px;
        padding: 1px; /* Reduced padding for a more compact appearance */
        border: 1px solid #ced4da; /* Border for reply box */
        border-radius: 12px; /* Slightly rounded corners */
        display: flex; /* Flexbox for alignment */
        line-height: 0.9; /* Adjust line height for better readability */
        max-width: 800px; /* Set a maximum width for reply boxes */
    }
    
    
   
    
    .reply-content {
        font-weight: bold; /* Normal weight for reply content */
        font-size: 12px; /* Adjust font size as needed */
        line-height: 1.2; /* Adjust line height for better readability */
        color: #585867; /* Color for reply content */
        white-space: normal; /* Allow text to wrap */
        overflow-wrap: break-word; /* Break long words to prevent overflow */
    }


    
    .profile-pic {
        width: 30px; /* Fixed size for profile picture */
        height: 30px; /* Fixed size for profile picture */
        border-radius: 50%; /* Make it circular */
        border: 1.6px solid #2b33fa;
        margin-right: 15px; /* Space between image and text */
        margin-bottom: -50px;
    }
    
   
    
    .reply-header {
        display: flex; /* Use flexbox for header alignment */
        justify-content: space-between; /* Space between author and timestamp */
        align-items: center; /* Center align items vertically */
        margin-bottom: -10px; /* Space below the header */
    }
    
    
    .created-at {
        font-size: 10px; /* Smaller font for timestamp */
        color: #0d09f5; /* Color for timestamp */
    }
    
    
   
    
    .btn-reply {
        background-color: #fb07e7; /* Button color */
        color: white; /* Button text color */
        padding: 1px 13px; /* Padding for button */
        border: none; /* No border */
        border-radius: 10px; /* Rounded corners */
        cursor: pointer; /* Pointer cursor on hover */
        font-size: 11px; /* Button font size */
    }
    
    .btn-reply:hover {
        background-color: #0056b3; /* Darker color on hover */
    }

    

    /* More replies button */
    .more-replies {
        background-color: #007bff; /* Primary color (Bootstrap blue) */
        color: white; /* Text color */
        padding: 3px 11px; /* Vertical and horizontal padding */
        border: none; /* No border */
        border-radius: 10px; /* Slightly rounded corners */
        cursor: pointer; /* Pointer cursor on hover */
        font-size: 10px; /* Font size */
        margin-top: 5px; /* Space above the button */
        transition: background-color 0.3s ease; /* Smooth transition for background color */
        display: inline-block; /* Inline-block to fit content */
        float: right;
    }
    
    .more-replies:hover {
        background-color: #0056b3; /* Darker shade on hover */
        text-decoration: underline; /* Underline text on hover */
    }
    
    .more-replies:focus {
        outline: none; /* Remove the default outline */
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.5); /* Add a subtle shadow for focus */
    }


/* Responsive Styles for 768px */
@media (max-width: 768px) {
    .main-image {
        width: 70%; /* Full width for smaller screens */
        height: auto; /* Maintain aspect ratio */
    }

    .section-heading {
        font-size: 2.5rem; /* Smaller heading size */
        width: 500px;
    }

    .blog-content {
        font-size: 1.4rem; /* Slightly smaller font size */
        line-height: 1.2;
        color: #000000;
        text-align: justify;
        margin: 0 1.5rem;
        word-spacing: 0.1rem;
        padding: 0;
        margin-left: 5px;
        width: 470px;
        
    }


    

    .post-meta {
        font-size: 1rem; /* Smaller font size */
    }

    .sidebar {
        width: 48%; /* Full width for sidebar */
        float: none; /* Remove float for stacking */
        margin-left: 520px; /* Reset margin */
        margin-top: -870px;
    }

    .related-image {
        width: 62%; /* Full width for related images */
        height: 180px; /* Maintain aspect ratio */
    }

    .like-btn, .comment-toggle-btn {
        width: 15%; /* Full width buttons */
        font-size: 1rem; /* Smaller font size */
    }


    .comment-toggle-btn {
        width: 15%; /* Full width on smaller screens */
        margin-right: -1px; /* Reset margin for alignment */
        margin-top: 40px; /* Adjust margin for better spacing */
    }

    .comment-form-container {
        margin-left: 0; /* Reset margin for alignment */
        margin-top: 40px;
        padding: 20px; /* Increase padding for touch devices */
    }

    .comment-form {
        width: 100%; /* Full width on smaller screens */
    }

    .comment-form input[type="text"],
    .comment-form textarea {
        height: 40px; /* Adjust height for smaller screens */
        font-size: 12px; /* Decrease font size */
    }

    .comment-form button {
        width: 15%; /* Full width for button */
        height: 30px; /* Adjust height for button */
        font-size: 12px; /* Decrease font size */
    }


    .reply-form-container {
        max-width: 100%; /* Make the reply form full width on smaller screens */
        padding-left: 5px; /* Adjust padding for better spacing */
        margin-top: 10px;
    }

    .reply-form-container input[type="text"],
    .reply-form-container textarea {
        height: 35px; /* Increase height for better usability on touch devices */
        font-size: 12px; /* Decrease font size for smaller screens */
    }

    .reply-btn {
        width: 15%; /* Full width on smaller screens */
        height: 20px; /* Adjust height for button */
        font-size: 10px; /* Adjust font size for smaller screens */
    }

    

    

    

    .reply-btn, .btn-reply, .more-replies {
        width: 15%; /* Full width buttons */
        font-size: 10px; /* Smaller font size */
    }

    .comment-box {
        width: 100%; /* Full width on smaller screens */
        margin-left: 0; /* Reset margin for alignment */
        padding: 15px; /* Increased padding for better spacing */
        box-shadow: none; /* Remove shadow for simplicity */
    }

    .reply-box {
        margin-left: 20px; /* Adjust margin for replies on smaller screens */
        width: calc(100% - 20px); /* Full width minus margin */
        padding: 5px; /* Adjust padding for smaller screens */
    }
}

/* Responsive Styles for 520px */
/* Responsive Styles for 520px */
@media (max-width: 520px) {
    .main-image {
        width: 75%; /* Full width for smaller screens */
        height: auto; /* Maintain aspect ratio */
    }

    .section-heading {
        font-size: 0.9rem; /* Smaller heading size */
        width: 360px;
    }

    .blog-content {
        font-size: 1.2rem; /* Further decrease font size */
        line-height: 1.4; /* Slightly increase line height for readability */
        color: #000000;
        text-align: justify;
        margin: 0 1rem; /* Adjust margins for smaller screens */
        word-spacing: 0.1rem;
        padding: 0;
        width: 330px;
    }

    .post-meta {
        font-size: 0.9rem; /* Smaller font size */
    }

    .sidebar {
        width: 60%; /* Full width for sidebar */
        float: none; /* Remove float for stacking */
        margin-left: 350px; /* Reset margin */
        margin-top: -740px; /* Reset margin */
    }

    .side-images {
        display: flex;
        flex-direction: column;
        margin-top: -90px;
    }

    .related-image {
        width: 45%; /* Full width for related images */
        height: 130px; /* Maintain aspect ratio */
    }

    .like-btn, .comment-toggle-btn {
        width: 20%; /* Full width buttons */
        font-size: 0.9rem; /* Smaller font size */
    }

    .comment-toggle-btn {
        width: 20%; /* Full width on smaller screens */
        margin-right: -10px; /* Reset margin for alignment */
        margin-top: 190px; /* Adjust margin for better spacing */
    }

    .comment-form-container {
        margin-left: 0; /* Reset margin for alignment */
        margin-top: 190px;
        padding: 5px; /* Decrease padding for compactness */
    }

    .comment-form {
        width: 100%; /* Full width on smaller screens */
    }

    .comment-form input[type="text"],
    .comment-form textarea {
        height: 35px; /* Adjust height for smaller screens */
        font-size: 11px; /* Decrease font size */
    }

    .comment-form button {
        width: 20%; /* Full width for button */
        height: 20px; /* Adjust height for button */
        font-size: 8px; /* Decrease font size */
    }

    .reply-form-container {
        max-width: 100%; /* Make the reply form full width on smaller screens */
        padding-left: 5px; /* Adjust padding for better spacing */
        margin-top: 10px;
    }

    .reply-form-container input[type="text"],
    .reply-form-container textarea {
        height: 30px; /* Adjust height for better usability on touch devices */
        font-size: 11px; /* Decrease font size for smaller screens */
    }

    .reply-btn {
        width: 20%; /* Full width on smaller screens */
        height: 25px; /* Adjust height for button */
        font-size: 10px; /* Adjust font size for smaller screens */
    }

    .reply-btn, .btn-reply, .more-replies {
        width: 20%; /* Full width buttons */
        font-size: 10px; /* Smaller font size */
    }

    .comment-box {
        width: 100%; /* Full width on smaller screens */
        margin-left: 0; /* Reset margin for alignment */
        margin-bottom: 90px;
        padding: 10px; /* Decreased padding for compactness */
        box-shadow: none; /* Remove shadow for simplicity */
    }

    .reply-box {
        margin-left: 0; /* Remove left margin for replies */
        width: 100%; /* Full width */
        padding: 5px; /* Adjust padding for smaller screens */
    }
}

/* Responsive Styles for 480px */


</style>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

    // JavaScript to change main and sidebar images at different intervals
    const mainImages = [
        {% for image in images %}
            "{{ image.image.url }}"{% if not forloop.last %}, {% endif %}
        {% endfor %}
    ];
    let currentMainIndex = 0;
    const mainImageElement = document.getElementById('main-image');

    // Select the sidebar images
    const sidebarImages = document.querySelectorAll('#sidebar-images .related-image');
    const totalSidebarImages = sidebarImages.length;

    // Function to get a random image from an array
    function getRandomImage(images) {
        const randomIndex = Math.floor(Math.random() * images.length);
        return images[randomIndex];
    }

    // Function to change the main image
    function changeMainImage() {
        currentMainIndex = (currentMainIndex + 1) % mainImages.length;  // Loop back to the start
        mainImageElement.src = mainImages[currentMainIndex];
    }

    // Function to change a specific sidebar image
    function changeSidebarImage(index) {
        const sidebarImage = sidebarImages[index];
        const imgElement = sidebarImage.querySelector('img');

        // Get a random image for the sidebar
        const newImage = getRandomImage(mainImages); // You can replace mainImages with a specific array if needed

        // Change the image source
        imgElement.src = newImage;
    }

    // Change main image every 6 seconds
    setInterval(changeMainImage, 9000);

    // Change each sidebar image at different intervals
    sidebarImages.forEach((_, index) => {
        setInterval(() => {
            changeSidebarImage(index);
        }, 10000 + index * 1000); // Stagger the intervals (e.g., 9s, 10s, 11s, etc.)
    });

  // JavaScript code
  // JavaScript code
  var csrftoken = getCookie('csrftoken');

  function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie != '') {
          var cookies = document.cookie.split(';');
          for (var i = 0; i < cookies.length; i++) {
              var cookie = jQuery.trim(cookies[i]);
              if (cookie.substring(0, name.length + 1) == (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }

  $(document).ready(function() {
    console.log("JavaScript code executed");
    
    $(".like-btn").click(async function(event) {
        event.preventDefault();
        console.log("Like button clicked");
        var obj_id = $(this).data("obj-id");
        var obj_type = $(this).data("obj-type");
        console.log("{% url 'like_unlike' %}");
        console.log({
            "obj_id": obj_id,
            "obj_type": obj_type
        });
        try {
            const response = await $.ajax({
                type: "POST",
                url: "{% url 'like_unlike' %}",
                data: {
                    "obj_id": obj_id,
                    "obj_type": obj_type
                },
                headers: {
                    'X-CSRFToken': csrftoken
                },
                dataType: "json"
            });
            console.log("AJAX request successful");
            if (response.liked) {
                $(this).text("Unlike");
            } else {
                $(this).text("Like");
            }
            if (response.obj_type == "post") {
                $("#likes-count-post").text("Likes: " + response.likes_count);
            } else {
                $("#likes-count-" + response.obj_id).text("Likes: " + response.likes_count);
            }
        } catch (error) {
            console.log("AJAX request failed");
            console.log(error);
            alert("Error liking/unliking: " + error);
        }
    });
    // Comment form toggle
    $(document).ready(function() {
        // Comment form toggle
        $("#comment-toggle-btn").click(function(event) {
            event.preventDefault(); // Prevent default action
            var commentFormContainer = $('.comment-form-container');
            commentFormContainer.slideToggle(); // Toggle visibility with slide effect
        });

        // Handle comment submission
        $("#comment-form").submit(function(event) {
            event.preventDefault(); // Prevent default form submission

            var commentInput = $("#comment-input").val().trim(); // Get and trim the comment input

            if (commentInput === "") {
                // Show error message if the comment is empty
                alert("Please enter a comment before submitting."); // You can replace this with a more user-friendly UI element
                return; // Exit the function to prevent submission
            }

            // If the comment is valid, append it to the comments section
            $(".comments-list").append("<div class='comment'>" + commentInput + "</div>");
            $("#comment-input").val(""); // Clear the input field
        });
    
        // Reply button click
        $(document).on('click', '.reply-btn', function(event) {
            event.preventDefault();
            var replyFormContainer = $(this).closest('.media').find('.reply-form-container');
    
            // Close other reply forms
            $('.reply-form-container').not(replyFormContainer).slideUp();
    
            // Toggle the visibility of the clicked reply form
            replyFormContainer.slideToggle();
        });
    
        // Reply form submission
        $(document).on('submit', '.reply-form-container form', function(event) {
            event.preventDefault();
            var form = $(this);
            var submitButton = form.find('button[type="submit"]');
        
            // Disable the button to prevent multiple submissions
            submitButton.prop('disabled', true).text('Submitting...');
        
            $.ajax({
                type: 'POST',
                url: form.attr('action'),
                data: form.serialize(),
                success: function(data) {
                    // Construct the new reply HTML
                    var replyHtml = `
                        <div class="media reply-box">
                            <img src="${data.profile_pic}" alt="Profile Picture" class="profile-pic reply-pic">
                            <div class="media-body">
                                <div class="reply-header">
                                    <h6>
                                        <span class="author">${data.author}</span>
                                        <span class="created-at"> -- ${data.created_at}</span>
                                    </h6>
                                </div>
                                <span class="reply-content">${data.reply}</span>
                            </div>
                        </div>`;
        
                    // Create a jQuery object from the replyHtml
                    var $reply = $(replyHtml).hide(); // Hide it initially
        
                    // Prepend the new reply to the reply container
                    var replyContainer = form.closest('.reply-form-container').siblings('.reply-container');
                    replyContainer.prepend($reply); // Add the new reply
        
                    // Fade in the new reply
                    $reply.fadeIn(400); // Fade in effect
        
                    // Check if the number of replies exceeds 4
                    if (replyContainer.children('.reply-box').length > 4) {
                        // If there are more than 4 replies, show the 'More replies' button
                        replyContainer.find('.more-replies').show();
                    }
        
                    form.find('textarea').val('');  // Clear the textarea
        
                    // Hide the reply form after submission
                    form.closest('.reply-form-container').slideUp();
                },
                error: function(xhr) {
                    alert("Error: " + xhr.responseJSON.error);
                },
                complete: function() {
                    // Reset the button state
                    submitButton.prop('disabled', false).text('Reply');
                }
            });
        });
    });
        // Show more replies

        $(document).ready(function() {
            // Initially hide all replies beyond the first four
            $('.hidden-reply').hide();
        
            // Show more replies
            $(document).on('click', '.more-replies', function(event) {
                event.preventDefault(); // Prevent default button behavior
                var $this = $(this); // Cache the button reference
                var replyContainer = $this.closest('.reply-container'); // Find the closest reply container
        
                // Check if the button text includes "More:"
                if ($this.text().includes('More:')) {
                    replyContainer.find('.hidden-reply').slideDown(); // Show hidden replies with a sliding effect
                    $this.text('Less replies'); // Change button text to "Less replies"
                } else {
                    replyContainer.find('.hidden-reply').slideUp(); // Hide replies with a sliding effect
                    $this.text('More: (' + replyContainer.find('.hidden-reply').length + ')'); // Update button text with count
                }
            });
        });
    });
</script>


</body>


{% endblock main_content %}